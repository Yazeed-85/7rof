<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ø´Ø¨ÙƒØ© Ø§Ù„Ø­Ø±ÙˆÙ</title>
  <style>
    /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØµÙØ­Ø© Ù„ØªÙƒÙˆÙ† Ù„ÙˆØ­Ø© Ù„Ø¹Ø¨ ÙƒØ§Ù…Ù„Ø© */
    body { 
        margin: 0; padding: 0; 
        height: 100vh; 
        width: 100vw;
        display: flex; 
        flex-direction: column; 
        font-family: Arial, sans-serif; 
        overflow: hidden; 
    }
    
    /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù„ÙˆÙŠ */
    .orange-zone-top {
        height: 15%; /* Ø³Ù…Ø§ÙƒØ© Ø§Ù„Ø´Ø±ÙŠØ· */
        width: 100%;
        background-color: #FF9800;
        border-bottom: 3px solid #E65100;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        z-index: 2;
    }

    /* Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡ (Ù…Ù„Ø¹Ø¨ Ø§Ù„Ù„Ø¹Ø¨) */
    .green-zone-middle {
        flex: 1; /* ÙŠØ£Ø®Ø° Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø³Ø§Ø­Ø© */
        width: 100%;
        background-color: #2e7d32; /* Ø£Ø®Ø¶Ø± ØºØ§Ù…Ù‚ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù…Ø«Ù„ Ø§Ù„ØµÙˆØ±Ø© */
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
    }

    /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ø§Ù„Ø³ÙÙ„ÙŠ */
    .orange-zone-bottom {
        height: 15%; /* Ø³Ù…Ø§ÙƒØ© Ø§Ù„Ø´Ø±ÙŠØ· */
        width: 100%;
        background-color: #FF9800;
        border-top: 3px solid #E65100;
        box-shadow: 0 -4px 10px rgba(0,0,0,0.2);
        z-index: 2;
    }

    /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø´Ø¨ÙƒØ© */
    .grid-container { 
        position: relative; 
        z-index: 5; 
        transform: scale(1.2); /* ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø´Ø¨ÙƒØ© Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„ØªÙƒÙˆÙ† ÙˆØ§Ø¶Ø­Ø© */
    }

    /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ */
    .hex-cell { cursor: pointer; transition: transform 0.1s; }
    .hex-cell:active { transform: scale(0.95); }
    
    /* Ø§Ù„Ù†ØµÙˆØµ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ */
    text { user-select: none; pointer-events: none; }

    /* ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ (ÙŠÙ…Ù†Ø¹ Ø§Ù„Ù„Ù…Ø³) */
    body.player-mode .hex-cell { cursor: not-allowed; pointer-events: none; }
    body.player-mode .host-tools { display: none !important; }

    /* Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù‡ÙˆØ³Øª (Ø¹Ø§Ø¦Ù…Ø©) */
    .host-tools { 
        position: absolute; 
        top: 20px; 
        left: 50%; 
        transform: translateX(-50%);
        display: flex; 
        gap: 10px; 
        z-index: 100;
        background: rgba(0,0,0,0.5);
        padding: 10px;
        border-radius: 15px;
    }
    
    .tool-btn { padding: 8px 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; transition: transform 0.2s;}
    .tool-btn:active { transform: scale(0.9); }
    .btn-green { background: #4CAF50; border: 2px solid #fff; }
    .btn-orange { background: #FF9800; border: 2px solid #fff; }
    .btn-shuffle { background: #333; }
    .selected { box-shadow: 0 0 10px 4px #FFD700; transform: scale(1.1); z-index: 101;}

  </style>
</head>
<body>

  <div class="orange-zone-top"></div>

  <div class="green-zone-middle">
      
      <div class="host-tools">
        <button class="tool-btn btn-shuffle" onclick="shuffleLetters()">ğŸ”€ Ø®Ù„Ø·</button>
        <button id="colorGreen" class="tool-btn btn-green selected" onclick="selectColor('#4CAF50', this)">Ø£Ø®Ø¶Ø±</button>
        <button id="colorOrange" class="tool-btn btn-orange" onclick="selectColor('#FF9800', this)">Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ</button>
        <button id="colorClear" class="tool-btn" style="background:#ddd; color:#000;" onclick="selectColor('url(#hexGradient)', this)">Ù…Ø³Ø­</button>
      </div>

      <div class="grid-container" id="hexGrid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 400" width="500" height="400">
          <defs>
            <linearGradient id="hexGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#ffffff" stop-opacity="1"/>
              <stop offset="100%" stop-color="#f0f0f0" stop-opacity="1"/>
            </linearGradient>
          </defs>
          
          <g class="hex-cell" data-index="0"><path d="M100,100 L130,83 L160,100 L160,134 L130,151 L100,134 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="130" y="125" font-size="20" font-weight="bold" text-anchor="middle">Ø£</text></g>
          <g class="hex-cell" data-index="1"><path d="M160,100 L190,83 L220,100 L220,134 L190,151 L160,134 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="190" y="125" font-size="20" font-weight="bold" text-anchor="middle">Ø¨</text></g>
          <g class="hex-cell" data-index="2"><path d="M220,100 L250,83 L280,100 L280,134 L250,151 L220,134 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="250" y="125" font-size="20" font-weight="bold" text-anchor="middle">Øª</text></g>
          <g class="hex-cell" data-index="3"><path d="M280,100 L310,83 L340,100 L340,134 L310,151 L280,134 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="310" y="125" font-size="20" font-weight="bold" text-anchor="middle">Ø«</text></g>
          <g class="hex-cell" data-index="4"><path d="M340,100 L370,83 L400,100 L400,134 L370,151 L340,134 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="370" y="125" font-size="20" font-weight="bold" text-anchor="middle">Ø¬</text></g>
          
          <g class="hex-cell" data-index="5"><path d="M70,151 L100,134 L130,151 L130,185 L100,202 L70,185 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="100" y="176" font-size="20" font-weight="bold" text-anchor="middle">Ø­</text></g>
          <g class="hex-cell" data-index="6"><path d="M130,151 L160,134 L190,151 L190,185 L160,202 L130,185 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="160" y="176" font-size="20" font-weight="bold" text-anchor="middle">Ø®</text></g>
          <g class="hex-cell" data-index="7"><path d="M190,151 L220,134 L250,151 L250,185 L220,202 L190,185 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="220" y="176" font-size="20" font-weight="bold" text-anchor="middle">Ø¯</text></g>
          <g class="hex-cell" data-index="8"><path d="M250,151 L280,134 L310,151 L310,185 L280,202 L250,185 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="280" y="176" font-size="20" font-weight="bold" text-anchor="middle">Ø°</text></g>
          <g class="hex-cell" data-index="9"><path d="M310,151 L340,134 L370,151 L370,185 L340,202 L310,185 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="340" y="176" font-size="20" font-weight="bold" text-anchor="middle">Ø±</text></g>

          <g class="hex-cell" data-index="10"><path d="M100,202 L130,185 L160,202 L160,236 L130,253 L100,236 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="130" y="227" font-size="20" font-weight="bold" text-anchor="middle">Ø²</text></g>
          <g class="hex-cell" data-index="11"><path d="M160,202 L190,185 L220,202 L220,236 L190,253 L160,236 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="190" y="227" font-size="20" font-weight="bold" text-anchor="middle">Ø³</text></g>
          <g class="hex-cell" data-index="12"><path d="M220,202 L250,185 L280,202 L280,236 L250,253 L220,236 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="250" y="227" font-size="20" font-weight="bold" text-anchor="middle">Ø´</text></g>
          <g class="hex-cell" data-index="13"><path d="M280,202 L310,185 L340,202 L340,236 L310,253 L280,236 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="310" y="227" font-size="20" font-weight="bold" text-anchor="middle">Øµ</text></g>
          <g class="hex-cell" data-index="14"><path d="M340,202 L370,185 L400,202 L400,236 L370,253 L340,236 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="370" y="227" font-size="20" font-weight="bold" text-anchor="middle">Ø¶</text></g>

          <g class="hex-cell" data-index="15"><path d="M70,253 L100,236 L130,253 L130,287 L100,304 L70,287 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="100" y="278" font-size="20" font-weight="bold" text-anchor="middle">Ø·</text></g>
          <g class="hex-cell" data-index="16"><path d="M130,253 L160,236 L190,253 L190,287 L160,304 L130,287 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="160" y="278" font-size="20" font-weight="bold" text-anchor="middle">Ø¸</text></g>
          <g class="hex-cell" data-index="17"><path d="M190,253 L220,236 L250,253 L250,287 L220,304 L190,287 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="220" y="278" font-size="20" font-weight="bold" text-anchor="middle">Ø¹</text></g>
          <g class="hex-cell" data-index="18"><path d="M250,253 L280,236 L310,253 L310,287 L280,304 L250,287 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="280" y="278" font-size="20" font-weight="bold" text-anchor="middle">Øº</text></g>
          <g class="hex-cell" data-index="19"><path d="M310,253 L340,236 L370,253 L370,287 L340,304 L310,287 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="340" y="278" font-size="20" font-weight="bold" text-anchor="middle">Ù</text></g>

          <g class="hex-cell" data-index="20"><path d="M100,304 L130,287 L160,304 L160,338 L130,355 L100,338 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="130" y="329" font-size="20" font-weight="bold" text-anchor="middle">Ù‚</text></g>
          <g class="hex-cell" data-index="21"><path d="M160,304 L190,287 L220,304 L220,338 L190,355 L160,338 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="190" y="329" font-size="20" font-weight="bold" text-anchor="middle">Ùƒ</text></g>
          <g class="hex-cell" data-index="22"><path d="M220,304 L250,287 L280,304 L280,338 L250,355 L220,338 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="250" y="329" font-size="20" font-weight="bold" text-anchor="middle">Ù„</text></g>
          <g class="hex-cell" data-index="23"><path d="M280,304 L310,287 L340,304 L340,338 L310,355 L280,338 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="310" y="329" font-size="20" font-weight="bold" text-anchor="middle">Ù…</text></g>
          <g class="hex-cell" data-index="24"><path d="M340,304 L370,287 L400,304 L400,338 L370,355 L340,338 Z" fill="url(#hexGradient)" stroke="black" stroke-width="2"/><text x="370" y="329" font-size="20" font-weight="bold" text-anchor="middle">Ù†</text></g>
        </svg>
      </div>
  </div>

  <div class="orange-zone-bottom"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
    
    const firebaseConfig = {
        apiKey: "AIzaSyB5CobIKfYdAz8jaabJpMQrGoqS9Ton28Y",
        authDomain: "buttons-f3501.firebaseapp.com",
        databaseURL: "https://buttons-f3501-default-rtdb.firebaseio.com",
        projectId: "buttons-f3501"
    };
    
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    const urlParams = new URLSearchParams(window.location.search);
    const pin = urlParams.get('pin');
    const role = urlParams.get('role');

    if (role === 'player') document.body.classList.add('player-mode');

    // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø´Ø¨ÙƒØ©
    const gridRef = ref(database, `rooms/${pin}/grid`);
    let activePaintColor = "#4CAF50"; 

    onValue(gridRef, (snapshot) => {
        const data = snapshot.val();
        if (data) {
            document.querySelectorAll(".hex-cell").forEach((cell, index) => {
                const cellData = data[index];
                if (cellData) {
                    const text = cell.querySelector("text");
                    const path = cell.querySelector("path");
                    if (text && cellData.letter) {
                        text.textContent = cellData.letter;
                        // ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ù†Øµ Ù„Ù„Ø£Ø¨ÙŠØ¶ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø®Ù„ÙŠØ© Ù…Ù„ÙˆÙ†Ø©
                        if(cellData.color && cellData.color !== "url(#hexGradient)"){
                            text.setAttribute("fill", "white");
                        } else {
                            text.setAttribute("fill", "black");
                        }
                    }
                    if (path) path.setAttribute("fill", cellData.color || "url(#hexGradient)");
                }
            });
        }
    });

    if (role === 'host') {
        window.selectColor = function(color, btn) {
            activePaintColor = color;
            document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
        };

        document.querySelectorAll(".hex-cell").forEach((cell) => {
            cell.addEventListener("click", function() {
                const index = this.getAttribute("data-index");
                const letter = this.querySelector("text").textContent;
                
                set(ref(database, `rooms/${pin}/grid/${index}`), {
                    letter: letter,
                    color: activePaintColor
                });
            });
        });

        window.shuffleLetters = function() {
            const letters = ["Ø£","Ø¨","Øª","Ø«","Ø¬","Ø­","Ø®","Ø¯","Ø°","Ø±","Ø²","Ø³","Ø´","Øµ","Ø¶","Ø·","Ø¸","Ø¹","Øº","Ù","Ù‚","Ùƒ","Ù„","Ù…","Ù†","Ù‡","Ùˆ","ÙŠ"];
            for (let i = letters.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [letters[i], letters[j]] = [letters[j], letters[i]];
            }
            
            const updates = {};
            document.querySelectorAll(".hex-cell").forEach((cell, index) => {
                updates[index] = { letter: letters[index] || "ØŸ", color: "url(#hexGradient)" };
            });
            set(gridRef, updates);
        };
    }
  </script>
</body>
</html>

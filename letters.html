<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ø´Ø¨ÙƒØ© Ø§Ù„Ø­Ø±ÙˆÙ</title>
  <style>
    body { 
        margin: 0; padding: 0; 
        background-color: transparent; 
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        height: 100vh; font-family: 'Segoe UI', Arial, sans-serif; overflow: hidden; 
    }
    
    .host-tools { 
        display: flex; gap: 10px; margin-bottom: 15px; z-index: 100;
        background: rgba(0,0,0,0.6); padding: 10px 20px; border-radius: 15px;
        backdrop-filter: blur(5px);
    }
    .tool-btn { padding: 8px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; font-size: 0.95rem; box-shadow: 0 4px 6px rgba(0,0,0,0.3); transition: transform 0.1s;}
    .tool-btn:active { transform: scale(0.95); }
    .btn-green { background: #4CAF50; border: 2px solid #81C784;}
    .btn-orange { background: #FF9800; border: 2px solid #FFB74D;}
    .btn-shuffle { background: #334155; border: 2px solid #64748b;}
    .selected { box-shadow: 0 0 0 3px #fff, 0 0 15px rgba(255,255,255,0.5); transform: scale(1.05); }

    /* Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø¨Ø¯ÙˆÙ† Ø¶ØºØ·) */
    .game-board-container {
        position: relative;
        width: 95%;
        max-width: 650px; 
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 15px 35px rgba(0,0,0,0.6);
        border: 4px solid #fff; 
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #2e7d32;
    }

    .grid-container { 
        width: 100%; 
        display: flex; justify-content: center; align-items: center;
    }

    .hex-cell { 
        cursor: pointer; 
        transition: transform 0.15s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        filter: drop-shadow(3px 5px 3px rgba(0,0,0,0.4)); 
    }
    .hex-cell:active { transform: scale(0.90); }
    .hex-cell path { stroke: #1e293b; stroke-width: 2.5px; }
    
    text { 
        pointer-events: none; 
        user-select: none; 
        font-family: 'Segoe UI', sans-serif; 
        fill: #000 !important; 
        font-weight: 800;
        text-anchor: middle; 
        dominant-baseline: middle; 
    }
    
    body.player-mode .hex-cell { cursor: not-allowed; pointer-events: none; }
    body.player-mode .host-tools { display: none !important; }
  </style>
</head>
<body>
    
  <div class="host-tools">
    <button class="tool-btn btn-shuffle" onclick="shuffleLetters()">ğŸ”€ Ø®Ù„Ø· Ø§Ù„Ø­Ø±ÙˆÙ</button>
    <button id="colorGreen" class="tool-btn btn-green selected" onclick="selectColor('#4CAF50', this)">Ø£Ø®Ø¶Ø±</button>
    <button id="colorOrange" class="tool-btn btn-orange" onclick="selectColor('#FF9800', this)">Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ</button>
    <button id="colorClear" class="tool-btn" style="background:#e2e8f0; color:#0f172a;" onclick="selectColor('url(#hexGradient)', this)">Ù…Ø³Ø­</button>
  </div>

  <div class="game-board-container">
      <div class="grid-container" id="hexGrid">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="30 20 410 400" width="100%" height="100%">
          <defs>
            <linearGradient id="hexGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#ffffff" stop-opacity="1"/>
              <stop offset="100%" stop-color="#f1f5f9" stop-opacity="1"/>
            </linearGradient>
          </defs>
          
          <rect x="-100" y="-100" width="1000" height="183" fill="#FF9800" />
          
          <rect x="-100" y="83" width="1000" height="272" fill="#2e7d32" />
          
          <rect x="-100" y="355" width="1000" height="500" fill="#FF9800" />

          <g class="hex-cell" data-index="0"><path d="M100,100 L130,83 L160,100 L160,134 L130,151 L100,134 Z" fill="url(#hexGradient)"/><text x="130" y="117" dy="4" font-size="24">Ø£</text></g>
          <g class="hex-cell" data-index="1"><path d="M160,100 L190,83 L220,100 L220,134 L190,151 L160,134 Z" fill="url(#hexGradient)"/><text x="190" y="117" dy="4" font-size="24">Ø¨</text></g>
          <g class="hex-cell" data-index="2"><path d="M220,100 L250,83 L280,100 L280,134 L250,151 L220,134 Z" fill="url(#hexGradient)"/><text x="250" y="117" dy="4" font-size="24">Øª</text></g>
          <g class="hex-cell" data-index="3"><path d="M280,100 L310,83 L340,100 L340,134 L310,151 L280,134 Z" fill="url(#hexGradient)"/><text x="310" y="117" dy="4" font-size="24">Ø«</text></g>
          <g class="hex-cell" data-index="4"><path d="M340,100 L370,83 L400,100 L400,134 L370,151 L340,134 Z" fill="url(#hexGradient)"/><text x="370" y="117" dy="4" font-size="24">Ø¬</text></g>
          
          <g class="hex-cell" data-index="5"><path d="M70,151 L100,134 L130,151 L130,185 L100,202 L70,185 Z" fill="url(#hexGradient)"/><text x="100" y="168" dy="4" font-size="24">Ø­</text></g>
          <g class="hex-cell" data-index="6"><path d="M130,151 L160,134 L190,151 L190,185 L160,202 L130,185 Z" fill="url(#hexGradient)"/><text x="160" y="168" dy="4" font-size="24">Ø®</text></g>
          <g class="hex-cell" data-index="7"><path d="M190,151 L220,134 L250,151 L250,185 L220,202 L190,185 Z" fill="url(#hexGradient)"/><text x="220" y="168" dy="4" font-size="24">Ø¯</text></g>
          <g class="hex-cell" data-index="8"><path d="M250,151 L280,134 L310,151 L310,185 L280,202 L250,185 Z" fill="url(#hexGradient)"/><text x="280" y="168" dy="4" font-size="24">Ø°</text></g>
          <g class="hex-cell" data-index="9"><path d="M310,151 L340,134 L370,151 L370,185 L340,202 L310,185 Z" fill="url(#hexGradient)"/><text x="340" y="168" dy="4" font-size="24">Ø±</text></g>

          <g class="hex-cell" data-index="10"><path d="M100,202 L130,185 L160,202 L160,236 L130,253 L100,236 Z" fill="url(#hexGradient)"/><text x="130" y="219" dy="4" font-size="24">Ø²</text></g>
          <g class="hex-cell" data-index="11"><path d="M160,202 L190,185 L220,202 L220,236 L190,253 L160,236 Z" fill="url(#hexGradient)"/><text x="190" y="219" dy="4" font-size="24">Ø³</text></g>
          <g class="hex-cell" data-index="12"><path d="M220,202 L250,185 L280,202 L280,236 L250,253 L220,236 Z" fill="url(#hexGradient)"/><text x="250" y="219" dy="4" font-size="24">Ø´</text></g>
          <g class="hex-cell" data-index="13"><path d="M280,202 L310,185 L340,202 L340,236 L310,253 L280,236 Z" fill="url(#hexGradient)"/><text x="310" y="219" dy="4" font-size="24">Øµ</text></g>
          <g class="hex-cell" data-index="14"><path d="M340,202 L370,185 L400,202 L400,236 L370,253 L340,236 Z" fill="url(#hexGradient)"/><text x="370" y="219" dy="4" font-size="24">Ø¶</text></g>

          <g class="hex-cell" data-index="15"><path d="M70,253 L100,236 L130,253 L130,287 L100,304 L70,287 Z" fill="url(#hexGradient)"/><text x="100" y="270" dy="4" font-size="24">Ø·</text></g>
          <g class="hex-cell" data-index="16"><path d="M130,253 L160,236 L190,253 L190,287 L160,304 L130,287 Z" fill="url(#hexGradient)"/><text x="160" y="270" dy="4" font-size="24">Ø¸</text></g>
          <g class="hex-cell" data-index="17"><path d="M190,253 L220,236 L250,253 L250,287 L220,304 L190,287 Z" fill="url(#hexGradient)"/><text x="220" y="270" dy="4" font-size="24">Ø¹</text></g>
          <g class="hex-cell" data-index="18"><path d="M250,253 L280,236 L310,253 L310,287 L280,304 L250,287 Z" fill="url(#hexGradient)"/><text x="280" y="270" dy="4" font-size="24">Øº</text></g>
          <g class="hex-cell" data-index="19"><path d="M310,253 L340,236 L370,253 L370,287 L340,304 L310,287 Z" fill="url(#hexGradient)"/><text x="340" y="270" dy="4" font-size="24">Ù</text></g>

          <g class="hex-cell" data-index="20"><path d="M100,304 L130,287 L160,304 L160,338 L130,355 L100,338 Z" fill="url(#hexGradient)"/><text x="130" y="321" dy="4" font-size="24">Ù‚</text></g>
          <g class="hex-cell" data-index="21"><path d="M160,304 L190,287 L220,304 L220,338 L190,355 L160,338 Z" fill="url(#hexGradient)"/><text x="190" y="321" dy="4" font-size="24">Ùƒ</text></g>
          <g class="hex-cell" data-index="22"><path d="M220,304 L250,287 L280,304 L280,338 L250,355 L220,338 Z" fill="url(#hexGradient)"/><text x="250" y="321" dy="4" font-size="24">Ù„</text></g>
          <g class="hex-cell" data-index="23"><path d="M280,304 L310,287 L340,304 L340,338 L310,355 L280,338 Z" fill="url(#hexGradient)"/><text x="310" y="321" dy="4" font-size="24">Ù…</text></g>
          <g class="hex-cell" data-index="24"><path d="M340,304 L370,287 L400,304 L400,338 L370,355 L340,338 Z" fill="url(#hexGradient)"/><text x="370" y="321" dy="4" font-size="24">Ù†</text></g>
        </svg>
      </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
    
    const firebaseConfig = {
        apiKey: "AIzaSyB5CobIKfYdAz8jaabJpMQrGoqS9Ton28Y",
        authDomain: "buttons-f3501.firebaseapp.com",
        databaseURL: "https://buttons-f3501-default-rtdb.firebaseio.com",
        projectId: "buttons-f3501"
    };
    
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    const urlParams = new URLSearchParams(window.location.search);
    const pin = urlParams.get('pin');
    const role = urlParams.get('role');

    if (role === 'player') document.body.classList.add('player-mode');

    const gridRef = ref(database, `rooms/${pin}/grid`);
    let activePaintColor = "#4CAF50"; 

    onValue(gridRef, (snapshot) => {
        const data = snapshot.val();
        if (data) {
            document.querySelectorAll(".hex-cell").forEach((cell, index) => {
                const cellData = data[index];
                if (cellData) {
                    const text = cell.querySelector("text");
                    const path = cell.querySelector("path");
                    if (text && cellData.letter) {
                        text.textContent = cellData.letter;
                    }
                    if (path) path.setAttribute("fill", cellData.color || "url(#hexGradient)");
                }
            });
        }
    });

    if (role === 'host') {
        window.selectColor = function(color, btn) {
            activePaintColor = color;
            document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
        };

        document.querySelectorAll(".hex-cell").forEach((cell) => {
            cell.addEventListener("click", function() {
                const index = this.getAttribute("data-index");
                const letter = this.querySelector("text").textContent;
                set(ref(database, `rooms/${pin}/grid/${index}`), { letter: letter, color: activePaintColor });
            });
        });

        window.shuffleLetters = function() {
            const letters = ["Ø£","Ø¨","Øª","Ø«","Ø¬","Ø­","Ø®","Ø¯","Ø°","Ø±","Ø²","Ø³","Ø´","Øµ","Ø¶","Ø·","Ø¸","Ø¹","Øº","Ù","Ù‚","Ùƒ","Ù„","Ù…","Ù†","Ù‡","Ùˆ","ÙŠ"];
            for (let i = letters.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [letters[i], letters[j]] = [letters[j], letters[i]];
            }
            const updates = {};
            document.querySelectorAll(".hex-cell").forEach((cell, index) => {
                updates[index] = { letter: letters[index] || "ØŸ", color: "url(#hexGradient)" };
            });
            set(gridRef, updates);
        };
    }
  </script>
</body>
</html>
